define(["module","jquery","console"],function(requireModule,$,_console){var defaults={scope:document};var consoleConfig={style:"color:#09d;",level:requireModule.config().logLevel||"debug"};var _modules={};var ConsoleFactory={create:function(command,config,console){var levels={log:0,info:1,debug:2};var style=this._style;return function(){if(levels[command]>levels[config.level]){return}var fn=console[command]||console.log;var args=Array.prototype.slice.call(arguments,0);if(fn.apply){args.unshift(style);args.unshift("%cInitr");fn.apply(console,args)}else{args.unshift("Initr:");fn(args)}}}};var console={_style:requireModule.config().config,log:ConsoleFactory.create("log",consoleConfig,_console),info:ConsoleFactory.create("info",consoleConfig,_console),debug:ConsoleFactory.create("debug",consoleConfig,_console)};function Initr(config){this.options=$.extend({},defaults,config||{});console.debug("Starting...",config,this.options)}Initr.prototype={load:function(config){if(config&&typeof config=="object"){if(config.length){this.loadArray(config)}else{this.loadObject(config)}}},loadArray:function(configs){for(var i=0;i<configs.length;i++){this.loadObject(configs[i])}},loadObject:function(config){var $selection=config.selector?$(config.selector,this.options.scope):false;if($selection&&$selection.length){console.debug('Selection found for "'+config.selector+'" in ',this.options.scope);var src=this.normalizeSrc(config);if(src){console.debug("Loading sources...",src.join());this.loadSrc(src,function(){console.debug("Sources loaded...",src.join());var args=Array.prototype.slice.call(arguments,0),modules=[];for(var i=0;i<arguments.length;i++){modules.push(this.initModule(arguments[i],config,$selection))}_modules[config.name]={config:config,modules:modules}})}}},initModule:function(module,config,selection){console.debug(config.name,"config",config,selection.toArray());return new module(config,selection,this)},loadSrc:function(src,callback){var _this=this;require(src,function(){callback.apply(_this,arguments)})},normalizeSrc:function(module){return module.src?typeof module.src=="string"?[module.src]:module.src:null},getModules:function(){return _modules}};return Initr});